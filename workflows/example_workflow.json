{
  "last_node_id": 14,
  "last_link_id": 21,
  "nodes": [
    {
      "id": 1,
      "type": "LoadImage",
      "pos": [50, 200],
      "size": [315, 314],
      "title": "Load Source Image",
      "properties": { "Node name for S&R": "LoadImage" },
      "widgets_values": ["input.png"]
    },
    {
      "id": 2,
      "type": "SimpleTilesUprezDynamicTileSplit",
      "pos": [400, 200],
      "size": [350, 170],
      "title": "Split into Tiles (SimpleTiles Uprez)",
      "properties": {},
      "widgets_values": [768, 768, 128, "noise", 0],
      "inputs": [{ "name": "image", "type": "IMAGE", "link": 1 }],
      "outputs": [
        { "name": "tiles", "type": "IMAGE", "links": [2, 3, 16], "slot_index": 0 },
        { "name": "tile_calc", "type": "TILE_CALC", "links": [4, 20], "slot_index": 1 }
      ]
    },
    {
      "id": 3,
      "type": "DownloadAndLoadFlorence2Model",
      "pos": [50, 560],
      "size": [420, 120],
      "title": "Load Florence2 Model",
      "properties": {},
      "widgets_values": ["microsoft/Florence-2-large", "fp16", "sdpa", false],
      "outputs": [{ "name": "florence2_model", "type": "FL2MODEL", "links": [5], "slot_index": 0 }]
    },
    {
      "id": 4,
      "type": "Florence2BatchCaption",
      "pos": [780, 200],
      "size": [380, 230],
      "title": "Generate Per-Tile Captions",
      "properties": {},
      "widgets_values": [
        "detailed_caption",
        "high quality, detailed, sharp, ",
        ", professional photography, 8k",
        256
      ],
      "inputs": [
        { "name": "tiles", "type": "IMAGE", "link": 2 },
        { "name": "florence_model", "type": "FL2MODEL", "link": 5 },
        { "name": "tile_calc", "type": "TILE_CALC", "link": 4 }
      ],
      "outputs": [
        { "name": "prompts_preview", "type": "STRING", "links": [6], "slot_index": 0 },
        { "name": "prompts_list", "type": "STRING", "links": [7], "slot_index": 1 }
      ]
    },
    {
      "id": 5,
      "type": "TilePromptPreview",
      "pos": [780, 470],
      "size": [420, 180],
      "title": "Preview Tile Prompts",
      "properties": {},
      "inputs": [
        { "name": "tiles", "type": "IMAGE", "link": 3 },
        { "name": "prompts_preview", "type": "STRING", "link": 6 }
      ]
    },
    {
      "id": 6,
      "type": "CheckpointLoaderSimple",
      "pos": [50, 720],
      "size": [340, 100],
      "title": "Load Base Model",
      "properties": {},
      "widgets_values": ["sdxl_base.safetensors"],
      "outputs": [
        { "name": "MODEL", "type": "MODEL", "links": [8], "slot_index": 0 },
        { "name": "CLIP", "type": "CLIP", "links": [9, 10, 11], "slot_index": 1 },
        { "name": "VAE", "type": "VAE", "links": [12], "slot_index": 2 }
      ]
    },
    {
      "id": 7,
      "type": "PromptListToConditioning",
      "pos": [1220, 200],
      "size": [330, 80],
      "title": "Encode Per-Tile Prompts",
      "properties": {},
      "inputs": [
        { "name": "clip", "type": "CLIP", "link": 9 },
        { "name": "prompts_list", "type": "STRING", "link": 7 }
      ],
      "outputs": [
        { "name": "conditioning_list", "type": "CONDITIONING", "links": [13], "slot_index": 0 }
      ]
    },
    {
      "id": 8,
      "type": "CLIPTextEncode",
      "pos": [430, 720],
      "size": [420, 120],
      "title": "Negative Prompt",
      "properties": {},
      "widgets_values": [
        "blurry, low quality, artifacts, noise, jpeg artifacts, watermark, text"
      ],
      "inputs": [{ "name": "clip", "type": "CLIP", "link": 10 }],
      "outputs": [
        { "name": "CONDITIONING", "type": "CONDITIONING", "links": [14], "slot_index": 0 }
      ]
    },
    {
      "id": 9,
      "type": "CLIPTextEncode",
      "pos": [430, 870],
      "size": [420, 120],
      "title": "Fallback Positive Prompt",
      "properties": {},
      "widgets_values": ["high quality, detailed, sharp focus"],
      "inputs": [{ "name": "clip", "type": "CLIP", "link": 11 }],
      "outputs": [
        { "name": "CONDITIONING", "type": "CONDITIONING", "links": [15], "slot_index": 0 }
      ]
    },
    {
      "id": 10,
      "type": "TiledSamplerWithPromptList",
      "pos": [1220, 350],
      "size": [390, 360],
      "title": "Process Tiles with Per-Tile Prompts",
      "properties": {},
      "widgets_values": [42, 20, 7.0, "euler", "normal", 0.35],
      "inputs": [
        { "name": "model", "type": "MODEL", "link": 8 },
        { "name": "tiles", "type": "IMAGE", "link": 18 },
        { "name": "vae", "type": "VAE", "link": 12 },
        { "name": "negative", "type": "CONDITIONING", "link": 14 },
        { "name": "per_tile_positive", "type": "CONDITIONING", "link": 13 },
        { "name": "fallback_positive", "type": "CONDITIONING", "link": 15 }
      ],
      "outputs": [
        { "name": "processed_tiles", "type": "IMAGE", "links": [19], "slot_index": 0 }
      ]
    },
    {
      "id": 11,
      "type": "UpscaleModelLoader",
      "pos": [50, 980],
      "size": [340, 60],
      "title": "Load Upscale Model",
      "properties": {},
      "widgets_values": ["RealESRGAN_x4plus.pth"],
      "outputs": [
        { "name": "UPSCALE_MODEL", "type": "UPSCALE_MODEL", "links": [17], "slot_index": 0 }
      ]
    },
    {
      "id": 12,
      "type": "ImageUpscaleWithModel",
      "pos": [430, 980],
      "size": [340, 80],
      "title": "Pre-Upscale Tiles (Optional)",
      "properties": {},
      "inputs": [
        { "name": "upscale_model", "type": "UPSCALE_MODEL", "link": 17 },
        { "name": "image", "type": "IMAGE", "link": 16 }
      ],
      "outputs": [{ "name": "IMAGE", "type": "IMAGE", "links": [18], "slot_index": 0 }]
    },
    {
      "id": 13,
      "type": "SimpleTilesUprezDynamicTileMerge",
      "pos": [1660, 350],
      "size": [360, 150],
      "title": "Merge Tiles (SimpleTiles Uprez)",
      "properties": {},
      "widgets_values": [64, false, "tile_merge"],
      "inputs": [
        { "name": "images", "type": "IMAGE", "link": 19 },
        { "name": "tile_calc", "type": "TILE_CALC", "link": 20 }
      ],
      "outputs": [{ "name": "IMAGE", "type": "IMAGE", "links": [21], "slot_index": 0 }]
    },
    {
      "id": 14,
      "type": "SaveImage",
      "pos": [2060, 350],
      "size": [320, 270],
      "title": "Save Output",
      "properties": {},
      "widgets_values": ["upscaled_"],
      "inputs": [{ "name": "images", "type": "IMAGE", "link": 21 }]
    }
  ],
  "links": [
    [1, 1, 0, 2, 0, "IMAGE"],
    [2, 2, 0, 4, 0, "IMAGE"],
    [3, 2, 0, 5, 0, "IMAGE"],
    [4, 2, 1, 4, 2, "TILE_CALC"],
    [5, 3, 0, 4, 1, "FL2MODEL"],
    [6, 4, 0, 5, 1, "STRING"],
    [7, 4, 1, 7, 1, "STRING"],
    [8, 6, 0, 10, 0, "MODEL"],
    [9, 6, 1, 7, 0, "CLIP"],
    [10, 6, 1, 8, 0, "CLIP"],
    [11, 6, 1, 9, 0, "CLIP"],
    [12, 6, 2, 10, 2, "VAE"],
    [13, 7, 0, 10, 4, "CONDITIONING"],
    [14, 8, 0, 10, 3, "CONDITIONING"],
    [15, 9, 0, 10, 5, "CONDITIONING"],
    [16, 2, 0, 12, 1, "IMAGE"],
    [17, 11, 0, 12, 0, "UPSCALE_MODEL"],
    [18, 12, 0, 10, 1, "IMAGE"],
    [19, 10, 0, 13, 0, "IMAGE"],
    [20, 2, 1, 13, 2, "TILE_CALC"],
    [21, 13, 0, 14, 0, "IMAGE"]
  ],
  "groups": [],
  "config": {},
  "extra": {
    "workflow_info": {
      "name": "Florence2 Per-Tile Upscaling (Integrated SimpleTiles Uprez)",
      "description": "Per-tile captioning + per-tile conditioning + tiled merge with advanced blending.",
      "version": "1.0.0",
      "required_nodes": ["ComfyUI-Florence2-Tile-prompt"]
    }
  }
}

